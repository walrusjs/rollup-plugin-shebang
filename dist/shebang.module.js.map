{"version":3,"file":"shebang.module.js","sources":["../src/index.ts"],"sourcesContent":["import { Plugin } from 'rollup';\nimport MagicString from 'magic-string';\n\nconst SHEBANG_RX = /^#!.*/;\n\nconst preserveShebangs = () => {\n  const shebangs: Record<string, string> = {};\n\n  const plugin: Plugin = {\n    name: 'rollup-plugin-preserve-shebangs',\n    transform(code, id) {\n      const match = code.match(SHEBANG_RX);\n\n      if (match) {\n        shebangs[id] = match[0];\n      }\n\n      code = code.replace(SHEBANG_RX, '');\n\n      return {\n        code,\n        map: null,\n      };\n    },\n    renderChunk(code, chunk, { sourcemap }) {\n      if (chunk.facadeModuleId && shebangs[chunk.facadeModuleId]) {\n        const str = new MagicString(code);\n        str.prepend(shebangs[chunk.facadeModuleId] + '\\n');\n        return {\n          code: str.toString(),\n          map: sourcemap ? str.generateMap({ hires: true }) : null,\n        };\n      }\n      return {\n        code,\n        map: null,\n      };\n    },\n  };\n\n  return plugin;\n};\n\nexport default preserveShebangs;"],"names":["SHEBANG_RX","shebangs","name","transform","code","id","match","replace","map","renderChunk","chunk","sourcemap","facadeModuleId","str","MagicString","prepend","toString","generateMap","hires"],"mappings":"4BAGA,IAAMA,EAAa,uBAEM,WACvB,IAAMC,EAAmC,GAkCzC,MAhCuB,CACrBC,KAAM,kCACNC,mBAAUC,EAAMC,GACd,IAAMC,EAAQF,EAAKE,MAAMN,GAQzB,OANIM,IACFL,EAASI,GAAMC,EAAM,IAKhB,CACLF,KAHFA,EAAOA,EAAKG,QAAQP,EAAY,IAI9BQ,IAAK,OAGTC,qBAAYL,EAAMM,SAASC,IAAAA,UACzB,GAAID,EAAME,gBAAkBX,EAASS,EAAME,gBAAiB,CAC1D,IAAMC,EAAM,IAAIC,EAAYV,GAE5B,OADAS,EAAIE,QAAQd,EAASS,EAAME,gBAAkB,MACtC,CACLR,KAAMS,EAAIG,WACVR,IAAKG,EAAYE,EAAII,YAAY,CAAEC,OAAO,IAAU,MAGxD,MAAO,CACLd,KAAAA,EACAI,IAAK"}